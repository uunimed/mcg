<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediClubGeorgia - ხელფასის კალკულატორი</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Login Page */
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 350px;
            text-align: center;
            display: block;
        }

        .main-container {
            display: none;
            width: 95%;
            max-width: 1200px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        /* Header outside container */
        .main-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            width: 95%;
            max-width: 1200px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .main-header h1 {
            font-size: 24px;
            font-weight: 600;
            line-height: 1.4;
        }

        h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 20px;
        }

        .input-group {
            margin: 20px 0;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .input-group input:focus {
            border-color: #667eea;
            outline: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        /* Main Content */
        .content {
            padding: 20px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .current-month {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #764ba2;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        /* Earning Panel */
        .earning-panel {
            background: linear-gradient(135deg, #4cd964 0%, #5ac8fa 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .total-earning {
            font-size: 36px;
            font-weight: 700;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 0;
        }

        td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }

        .shift-cell {
            background-color: #28a745 !important;
            color: white !important;
            font-weight: 600;
        }

        .date-header {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .type-header {
            background: #764ba2;
            color: white;
            font-weight: 600;
            min-width: 120px;
        }

        .insurance-cell {
            background-color: #ffc107;
            color: #333;
            font-weight: 600;
        }

        input[type="number"] {
            width: 70px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
        }

        input[type="number"]:focus {
            border-color: #667eea;
            outline: none;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h3 {
            font-size: 24px;
            color: #333;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .month-table-container {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .month-header {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        .month-table {
            width: 100%;
            border-collapse: collapse;
        }

        .month-table th, .month-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #e0e0e0;
            font-size: 12px;
        }

        .month-table th {
            background: #f8f9fa;
        }

        .no-data {
            padding: 20px;
            text-align: center;
            color: #666;
            font-style: italic;
        }

        /* Add Month Modal */
        .add-month-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-group {
            flex: 1;
        }

        /* Popup Box */
        .popup-box {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 1001;
            min-width: 300px;
            text-align: center;
        }

        .popup-box h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .popup-box p {
            margin-bottom: 20px;
            color: #666;
        }

        .popup-box .btn {
            width: auto;
            min-width: 100px;
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        /* Logout */
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        /* Footer */
        .prices-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 14px;
            color: #666;
        }

        .price-item {
            display: inline-block;
            margin-right: 20px;
        }

        .price-item i {
            margin-right: 5px;
            color: #667eea;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div style="margin-bottom: 30px;">
            <i class="fas fa-user-md" style="font-size: 48px; color: #667eea;"></i>
        </div>
        <h1>MediClubGeorgia</h1>
        <p style="color: #666; margin-bottom: 30px;">გთხოვთ შეიყვანოთ მონაცემები</p>
        
        <div class="input-group">
            <label for="username">მომხმარებელი</label>
            <input type="text" id="username" placeholder="შეიყვანეთ მომხმარებლის სახელი">
        </div>
        
        <div class="input-group">
            <label for="password">პაროლი</label>
            <input type="password" id="password" placeholder="შეიყვანეთ პაროლი">
        </div>
        
        <button class="btn" onclick="login()">
            <i class="fas fa-sign-in-alt"></i> შესვლა
        </button>
    </div>

    <!-- Header outside container -->
    <div class="main-header" id="mainHeader" style="display: none;">
        <h1>MediClubGeorgia-ში მუშაობის დროს ყოველთვიურად გამომუშავებული ხელფასის რაოდენობა</h1>
        <p style="opacity: 0.9; margin-top: 10px;">გამოთვლილი თარიღების დახმარებით, როდესაც შესრულდა მორიგეობა კონკრეტულ თვეში</p>
    </div>

    <!-- Main App -->
    <div class="main-container" id="mainApp">
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> გასვლა
        </button>

        <div class="content">
            <!-- Controls -->
            <div class="controls">
                <div class="current-month" id="currentMonth">სექტემბერი 2024</div>
                <div class="control-buttons">
                    <button class="control-btn btn-primary" onclick="showAddMonthModal()">
                        <i class="fas fa-plus"></i> ახალი თვე
                    </button>
                    <button class="control-btn btn-secondary" onclick="showOtherMonths()">
                        <i class="fas fa-calendar-alt"></i> სხვა თვეების ნახვა
                    </button>
                </div>
            </div>

            <!-- Earning Panel -->
            <div class="earning-panel">
                <div style="font-size: 14px; opacity: 0.9;">მთლიანი გამომუშავება</div>
                <div class="total-earning" id="totalEarning">0.00 ₾</div>
            </div>

            <!-- Main Table -->
            <div class="table-container">
                <table id="mainTable">
                    <thead>
                        <tr id="tableHeader">
                            <!-- Header will be generated here -->
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Table rows will be generated here -->
                    </tbody>
                </table>
            </div>

            <!-- Add Shift Button -->
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="control-btn btn-success" onclick="showAddShiftModal()" style="padding: 10px 30px;">
                    <i class="fas fa-plus-circle"></i> ახალი მორიგეობა
                </button>
            </div>

            <!-- Prices Info -->
            <div class="prices-info">
                <div class="price-item">
                    <i class="fas fa-clock"></i> 1 საათი მორიგეობა = 5.84 ₾
                </div>
                <div class="price-item">
                    <i class="fas fa-eye"></i> 1 ობსერვაცია = 7 ₾
                </div>
                <div class="price-item">
                    <i class="fas fa-tint"></i> 1 ჰემოტრანსფუზია = 5 ₾
                </div>
                <div class="price-item">
                    <i class="fas fa-bed"></i> 1 დღის სტაციონარი = 10 ₾
                </div>
                <div class="price-item">
                    <i class="fas fa-shield-alt"></i> დაზღვევა = -100 ₾
                </div>
            </div>
        </div>
    </div>

    <!-- Other Months Modal -->
    <div class="modal" id="otherMonthsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>სხვა თვეების ნახვა</h3>
                <button class="close-modal" onclick="closeOtherMonths()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="monthsContainer">
                <!-- Month tables will be generated here -->
            </div>
        </div>
    </div>

    <!-- Add Month Modal -->
    <div class="modal" id="addMonthModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ახალი თვის დამატება</h3>
                <button class="close-modal" onclick="closeAddMonthModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="add-month-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>თვე</label>
                        <select id="newMonth" class="form-control" style="width: 100%; padding: 10px; border-radius: 6px; border: 2px solid #ddd;">
                            <option value="0">იანვარი</option>
                            <option value="1">თებერვალი</option>
                            <option value="2">მარტი</option>
                            <option value="3">აპრილი</option>
                            <option value="4">მაისი</option>
                            <option value="5">ივნისი</option>
                            <option value="6">ივლისი</option>
                            <option value="7">აგვისტო</option>
                            <option value="8">სექტემბერი</option>
                            <option value="9">ოქტომბერი</option>
                            <option value="10">ნოემბერი</option>
                            <option value="11">დეკემბერი</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>წელი</label>
                        <input type="number" id="newYear" class="form-control" min="2020" max="2030" value="2024">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-success" onclick="addNewMonth()">
                        <i class="fas fa-plus"></i> დამატება
                    </button>
                    <button class="btn btn-danger" onclick="closeAddMonthModal()">
                        <i class="fas fa-times"></i> გაუქმება
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Shift Modal -->
    <div class="modal" id="addShiftModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ახალი მორიგეობის დამატება</h3>
                <button class="close-modal" onclick="closeAddShiftModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="add-month-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>თარიღი</label>
                        <select id="shiftDate" class="form-control" style="width: 100%; padding: 10px; border-radius: 6px; border: 2px solid #ddd;">
                            <!-- Dates will be populated here -->
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>მორიგეობა (საათები)</label>
                        <input type="number" id="shiftDuty" class="form-control" min="0" step="0.5" value="0">
                    </div>
                    <div class="form-group">
                        <label>ობსერვაცია</label>
                        <input type="number" id="shiftObs" class="form-control" min="0" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ჰემოტრანსფუზია</label>
                        <input type="number" id="shiftTrans" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>დღის სტაციონარი</label>
                        <input type="number" id="shiftStation" class="form-control" min="0" value="0">
                    </div>
                </div>
                <div class="form-row" style="align-items: center;">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="shiftInsurance">
                            დაზღვევა (-100 ₾)
                        </label>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-success" onclick="addNewShift()">
                        <i class="fas fa-plus"></i> დამატება
                    </button>
                    <button class="btn btn-danger" onclick="closeAddShiftModal()">
                        <i class="fas fa-times"></i> გაუქმება
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup Box -->
    <div class="popup-overlay" id="popupOverlay"></div>
    <div class="popup-box" id="popupBox">
        <h3 id="popupTitle">შეტყობინება</h3>
        <p id="popupMessage">ეს არის შეტყობინება</p>
        <button class="btn btn-primary" onclick="closePopup()">კარგი</button>
    </div>

    <script>
        // User credentials
        const USERNAME = "alex";
        const PASSWORD = "2911";

        // Current date
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        
        // Georgian month names
        const georgianMonths = [
            "იანვარი", "თებერვალი", "მარტი", "აპრილი", "მაისი", "ივნისი",
            "ივლისი", "აგვისტო", "სექტემბერი", "ოქტომბერი", "ნოემბერი", "დეკემბერი"
        ];

        // Data structure
        let monthlyData = {};

        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === USERNAME && password === PASSWORD) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainHeader').style.display = 'block';
                document.getElementById('mainApp').style.display = 'block';
                loadData();
                loadCurrentMonth();
                showPopup("მოგესალმებით, ალექს!", "success");
            } else {
                showPopup("არასწორი მომხმარებელი ან პაროლი!", "error");
            }
        }

        // Logout function
        function logout() {
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Show popup message
        function showPopup(message, type = "info") {
            const popupBox = document.getElementById('popupBox');
            const popupOverlay = document.getElementById('popupOverlay');
            const popupTitle = document.getElementById('popupTitle');
            const popupMessage = document.getElementById('popupMessage');
            
            popupMessage.textContent = message;
            
            if (type === "error") {
                popupTitle.textContent = "შეცდომა!";
                popupTitle.style.color = "#dc3545";
            } else if (type === "success") {
                popupTitle.textContent = "წარმატება!";
                popupTitle.style.color = "#28a745";
            } else {
                popupTitle.textContent = "ინფორმაცია";
                popupTitle.style.color = "#667eea";
            }
            
            popupOverlay.style.display = 'block';
            popupBox.style.display = 'block';
        }

        // Close popup
        function closePopup() {
            document.getElementById('popupOverlay').style.display = 'none';
            document.getElementById('popupBox').style.display = 'none';
        }

        // Load current month data
        function loadCurrentMonth() {
            const monthKey = `${currentYear}-${currentMonth}`;
            const monthName = georgianMonths[currentMonth];
            document.getElementById('currentMonth').textContent = `${monthName} ${currentYear}`;
            
            // Create table
            createMonthTable(monthKey);
        }

        // Create table for a month
        function createMonthTable(monthKey) {
            const monthData = monthlyData[monthKey] || { shifts: {}, insurance: false };
            const [year, month] = monthKey.split('-').map(Number);
            const daysInMonth = new Date(year, parseInt(month) + 1, 0).getDate();
            
            // Create header
            const tableHeader = document.getElementById('tableHeader');
            tableHeader.innerHTML = '<th class="type-header">თარიღი</th>';
            
            // Add date columns
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${day}/${month + 1}`;
                tableHeader.innerHTML += `<th class="date-header">${dateStr}</th>`;
            }
            
            // Add insurance column
            tableHeader.innerHTML += '<th class="type-header">დაზღვევა</th>';
            
            // Create rows
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            // Row 1: მორიგეობა (საათები)
            let row1 = '<tr><td class="type-header">მორიგეობა (საათები)</td>';
            for (let day = 1; day <= daysInMonth; day++) {
                const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
                const hasShift = shiftData.duty > 0 || shiftData.obs > 0 || shiftData.trans > 0 || shiftData.station > 0;
                const cellClass = hasShift ? 'shift-cell' : '';
                row1 += `<td class="${cellClass}">${shiftData.duty || 0}</td>`;
            }
            row1 += `<td><input type="checkbox" ${monthData.insurance ? 'checked' : ''} onchange="toggleInsurance(${month}, ${year}, this.checked)"></td></tr>`;
            
            // Row 2: ობსერვაცია
            let row2 = '<tr><td class="type-header">ობსერვაცია</td>';
            for (let day = 1; day <= daysInMonth; day++) {
                const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
                const hasShift = shiftData.duty > 0 || shiftData.obs > 0 || shiftData.trans > 0 || shiftData.station > 0;
                const cellClass = hasShift ? 'shift-cell' : '';
                row2 += `<td class="${cellClass}">${shiftData.obs || 0}</td>`;
            }
            row2 += `<td></td></tr>`;
            
            // Row 3: ჰემოტრანსფუზია
            let row3 = '<tr><td class="type-header">ჰემოტრანსფუზია</td>';
            for (let day = 1; day <= daysInMonth; day++) {
                const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
                const hasShift = shiftData.duty > 0 || shiftData.obs > 0 || shiftData.trans > 0 || shiftData.station > 0;
                const cellClass = hasShift ? 'shift-cell' : '';
                row3 += `<td class="${cellClass}">${shiftData.trans || 0}</td>`;
            }
            row3 += `<td></td></tr>`;
            
            // Row 4: დღის სტაციონარი
            let row4 = '<tr><td class="type-header">დღის სტაციონარი</td>';
            for (let day = 1; day <= daysInMonth; day++) {
                const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
                const hasShift = shiftData.duty > 0 || shiftData.obs > 0 || shiftData.trans > 0 || shiftData.station > 0;
                const cellClass = hasShift ? 'shift-cell' : '';
                row4 += `<td class="${cellClass}">${shiftData.station || 0}</td>`;
            }
            row4 += `<td></td></tr>`;
            
            tableBody.innerHTML = row1 + row2 + row3 + row4;
            
            // Calculate total
            calculateTotal(monthKey);
        }

        // Calculate total for a month
        function calculateTotal(monthKey) {
            const monthData = monthlyData[monthKey];
            if (!monthData) {
                document.getElementById('totalEarning').textContent = '0.00 ₾';
                return;
            }
            
            let total = 0;
            
            // Calculate from shifts
            Object.values(monthData.shifts).forEach(shift => {
                total += (shift.duty * 5.84) + (shift.obs * 7) + (shift.trans * 5) + (shift.station * 10);
            });
            
            // Subtract insurance if active
            if (monthData.insurance) {
                total -= 100;
            }
            
            document.getElementById('totalEarning').textContent = total.toFixed(2) + ' ₾';
            saveData();
        }

        // Toggle insurance for a month
        function toggleInsurance(month, year, isChecked) {
            const monthKey = `${year}-${month}`;
            if (!monthlyData[monthKey]) {
                monthlyData[monthKey] = { shifts: {}, insurance: false };
            }
            monthlyData[monthKey].insurance = isChecked;
            calculateTotal(monthKey);
            
            if (isChecked) {
                showPopup("დაზღვევა აქტიურია ამ თვისთვის", "info");
            }
        }

        // Show other months modal
        function showOtherMonths() {
            const monthsContainer = document.getElementById('monthsContainer');
            monthsContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> იტვირთება...</div>';
            
            setTimeout(() => {
                monthsContainer.innerHTML = '';
                
                // Get all months with data
                const monthKeys = Object.keys(monthlyData).sort().reverse();
                
                if (monthKeys.length === 0) {
                    monthsContainer.innerHTML = '<div class="no-data">სხვა თვეების მონაცემები ჯერ არ არის შენახული</div>';
                } else {
                    monthKeys.forEach(monthKey => {
                        const [year, month] = monthKey.split('-').map(Number);
                        const monthName = georgianMonths[month];
                        const monthData = monthlyData[monthKey];
                        
                        // Calculate total for this month
                        let monthTotal = 0;
                        Object.values(monthData.shifts).forEach(shift => {
                            monthTotal += (shift.duty * 5.84) + (shift.obs * 7) + (shift.trans * 5) + (shift.station * 10);
                        });
                        if (monthData.insurance) monthTotal -= 100;
                        
                        const monthCard = document.createElement('div');
                        monthCard.className = 'month-table-container';
                        monthCard.innerHTML = `
                            <div class="month-header">
                                ${monthName} ${year} - სულ: ${monthTotal.toFixed(2)} ₾
                            </div>
                            <table class="month-table">
                                <thead>
                                    <tr>
                                        <th>თარიღი</th>
                                        <th>მორიგეობა</th>
                                        <th>ობსერვაცია</th>
                                        <th>ჰემოტრანსფ.</th>
                                        <th>სტაციონარი</th>
                                        <th>დაზღვევა</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(monthData.shifts).map(([day, shift]) => `
                                        <tr>
                                            <td>${day}/${parseInt(month)+1}</td>
                                            <td>${shift.duty}</td>
                                            <td>${shift.obs}</td>
                                            <td>${shift.trans}</td>
                                            <td>${shift.station}</td>
                                            <td>${monthData.insurance ? 'კი' : 'არა'}</td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="6" style="text-align: center; color: #666;">მონაცემები არ არის</td></tr>'}
                                </tbody>
                            </table>
                        `;
                        monthsContainer.appendChild(monthCard);
                    });
                }
                
                document.getElementById('otherMonthsModal').style.display = 'flex';
            }, 500);
        }

        // Close other months modal
        function closeOtherMonths() {
            document.getElementById('otherMonthsModal').style.display = 'none';
        }

        // Show add month modal
        function showAddMonthModal() {
            document.getElementById('addMonthModal').style.display = 'flex';
        }

        // Close add month modal
        function closeAddMonthModal() {
            document.getElementById('addMonthModal').style.display = 'none';
        }

        // Add new month
        function addNewMonth() {
            const month = parseInt(document.getElementById('newMonth').value);
            const year = parseInt(document.getElementById('newYear').value);
            const monthKey = `${year}-${month}`;
            
            if (monthlyData[monthKey]) {
                showPopup("ეს თვე უკვე არსებობს!", "error");
                return;
            }
            
            monthlyData[monthKey] = { shifts: {}, insurance: false };
            currentMonth = month;
            currentYear = year;
            loadCurrentMonth();
            closeAddMonthModal();
            showPopup(`ახალი თვე დაემატა: ${georgianMonths[month]} ${year}`, "success");
        }

        // Show add shift modal
        function showAddShiftModal() {
            const monthKey = `${currentYear}-${currentMonth}`;
            if (!monthlyData[monthKey]) {
                showPopup("ჯერ შექმენით ამ თვის ცხრილი!", "error");
                return;
            }
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const shiftDateSelect = document.getElementById('shiftDate');
            shiftDateSelect.innerHTML = '';
            
            for (let day = 1; day <= daysInMonth; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = `${day}/${currentMonth + 1}`;
                shiftDateSelect.appendChild(option);
            }
            
            document.getElementById('addShiftModal').style.display = 'flex';
        }

        // Close add shift modal
        function closeAddShiftModal() {
            document.getElementById('addShiftModal').style.display = 'none';
        }

        // Add new shift
        function addNewShift() {
            const day = parseInt(document.getElementById('shiftDate').value);
            const duty = parseFloat(document.getElementById('shiftDuty').value) || 0;
            const obs = parseInt(document.getElementById('shiftObs').value) || 0;
            const trans = parseInt(document.getElementById('shiftTrans').value) || 0;
            const station = parseInt(document.getElementById('shiftStation').value) || 0;
            const insurance = document.getElementById('shiftInsurance').checked;
            
            const monthKey = `${currentYear}-${currentMonth}`;
            
            if (!monthlyData[monthKey].shifts[day]) {
                monthlyData[monthKey].shifts[day] = { duty: 0, obs: 0, trans: 0, station: 0 };
            }
            
            monthlyData[monthKey].shifts[day] = {
                duty: monthlyData[monthKey].shifts[day].duty + duty,
                obs: monthlyData[monthKey].shifts[day].obs + obs,
                trans: monthlyData[monthKey].shifts[day].trans + trans,
                station: monthlyData[monthKey].shifts[day].station + station
            };
            
            if (insurance) {
                monthlyData[monthKey].insurance = true;
            }
            
            loadCurrentMonth();
            closeAddShiftModal();
            showPopup(`მორიგეობა დაემატა ${day}/${currentMonth + 1} თარიღზე`, "success");
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('mediClubData', JSON.stringify(monthlyData));
        }

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('mediClubData');
            if (savedData) {
                monthlyData = JSON.parse(savedData);
            }
        }

        // Initialize
        window.onload = function() {
            // Add event listener for Enter key in login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // Set default year to current year
            document.getElementById('newYear').value = currentDate.getFullYear();
            document.getElementById('newMonth').value = currentDate.getMonth();
        };
    </script>
</body>
</html>
