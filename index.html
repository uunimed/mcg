<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediClubGeorgia - ხელფასის კალკულატორი</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* Header */
        .main-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            width: 100%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .main-header h1 {
            font-size: 24px;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: 5px;
        }

        .main-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        /* Login Page */
        .login-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 350px;
            text-align: center;
            z-index: 1000;
        }

        .main-container {
            display: none;
            width: 95%;
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 20px;
        }

        .input-group {
            margin: 20px 0;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .input-group input:focus {
            border-color: #3498db;
            outline: none;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        /* Main Content */
        .content {
            padding: 20px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .current-month {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #2c3e50;
            color: white;
        }

        .btn-secondary:hover {
            background: #1a252f;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219653;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        /* Earning Panel */
        .earning-panel {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .total-earning {
            font-size: 36px;
            font-weight: 700;
        }

        .expected-label {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 0;
        }

        td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s;
        }

        .shift-cell {
            background-color: #27ae60 !important;
            color: white !important;
            font-weight: 600;
            cursor: pointer;
        }

        .shift-cell:hover {
            background-color: #219653 !important;
            transform: scale(1.05);
        }

        .date-header {
            background: #3498db;
            color: white;
            font-weight: 600;
            min-width: 50px;
        }

        .type-header {
            background: #2c3e50;
            color: white;
            font-weight: 600;
            min-width: 150px;
            position: sticky;
            left: 0;
        }

        .insurance-cell {
            background-color: #f39c12;
            color: #333;
            font-weight: 600;
        }

        input[type="number"] {
            width: 70px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            background: transparent;
            color: inherit;
        }

        input[type="number"]:focus {
            border-color: #3498db;
            outline: none;
            background: white;
            color: #333;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h3 {
            font-size: 24px;
            color: #333;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .months-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .month-card {
            background: white;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .month-card-header {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        .month-card-content {
            padding: 15px;
        }

        .actual-amount-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 16px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-card .value {
            font-size: 20px;
            font-weight: 700;
            color: #3498db;
        }

        .no-data {
            padding: 40px;
            text-align: center;
            color: #666;
            font-style: italic;
        }

        /* Add Shift Modal */
        .shift-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .dates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .date-cell-select {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            background: white;
        }

        .date-cell-select:hover {
            border-color: #3498db;
            transform: scale(1.1);
        }

        .date-cell-select.selected {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .shift-form {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        /* Popup Box */
        .popup-box {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 1001;
            min-width: 300px;
            text-align: center;
        }

        .popup-box h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .popup-box p {
            margin-bottom: 20px;
            color: #666;
        }

        .popup-box .btn {
            width: auto;
            min-width: 100px;
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        /* Logout */
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            z-index: 100;
        }

        /* Footer */
        .prices-info {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            font-size: 14px;
            color: #666;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .price-item {
            display: inline-block;
            margin-right: 20px;
        }

        .price-item i {
            margin-right: 5px;
            color: #3498db;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* Edit cell popup */
        .edit-popup {
            position: absolute;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            z-index: 100;
            min-width: 200px;
            display: none;
        }

        .edit-popup h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .edit-popup input {
            width: 100px;
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .control-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .months-container {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="main-header" id="mainHeader" style="display: none;">
        <h1>MediClubGeorgia-ში მუშაობის დროს ყოველთვიურად გამომუშავებული ხელფასის რაოდენობა</h1>
        <p>გამოთვლილი თარიღების დახმარებით, როდესაც შესრულდა მორიგეობა კონკრეტულ თვეში</p>
    </div>

    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div style="margin-bottom: 30px;">
            <i class="fas fa-user-md" style="font-size: 48px; color: #3498db;"></i>
        </div>
        <h1>MediClubGeorgia</h1>
        <p style="color: #666; margin-bottom: 30px;">გთხოვთ შეიყვანოთ მონაცემები</p>
        
        <div class="input-group">
            <label for="username">მომხმარებელი</label>
            <input type="text" id="username" placeholder="შეიყვანეთ მომხმარებლის სახელი">
        </div>
        
        <div class="input-group">
            <label for="password">პაროლი</label>
            <input type="password" id="password" placeholder="შეიყვანეთ პაროლი">
        </div>
        
        <button class="btn" onclick="login()">
            <i class="fas fa-sign-in-alt"></i> შესვლა
        </button>
    </div>

    <!-- Main App -->
    <div class="main-container" id="mainApp">
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> გასვლა
        </button>

        <div class="content">
            <!-- Controls -->
            <div class="controls">
                <div class="current-month" id="currentMonth">სექტემბერი 2024</div>
                <div class="control-buttons">
                    <button class="control-btn btn-success" onclick="showAddMonthModal()">
                        <i class="fas fa-plus"></i> ახალი თვე
                    </button>
                    <button class="control-btn btn-warning" onclick="showAddShiftModal()">
                        <i class="fas fa-calendar-plus"></i> ახალი მორიგეობა
                    </button>
                    <button class="control-btn btn-primary" onclick="showOtherMonths()">
                        <i class="fas fa-calendar-alt"></i> სხვა თვეების ნახვა
                    </button>
                </div>
            </div>

            <!-- Earning Panel -->
            <div class="earning-panel">
                <div style="font-size: 14px; opacity: 0.9;">მოსალოდნელი გამომუშავება</div>
                <div class="total-earning" id="totalEarning">0.00 ₾</div>
                <div class="expected-label">(გაანგარიშებული თანხა)</div>
            </div>

            <!-- Main Table -->
            <div class="table-container">
                <table id="mainTable">
                    <thead>
                        <tr id="tableHeader">
                            <!-- Header will be generated here -->
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Table rows will be generated here -->
                    </tbody>
                </table>
            </div>

            <!-- Prices Info -->
            <div class="prices-info">
                <div class="price-item">
                    <i class="fas fa-clock"></i> 1 საათი მორიგეობა = 5.84 ₾
                </div>
                <div class="price-item">
                    <i class="fas fa-eye"></i> 1 ობსერვაცია = 7 ₾
                </div>
                <div class="price-item">
                    <i class="fas fa-tint"></i> 1 ჰემოტრანსფუზია = 5 ₾
                </div>
                <div class="price-item">
                    <i class="fas fa-bed"></i> 1 დღის სტაციონარი = 10 ₾
                </div>
                <div class="price-item">
                    <i class="fas fa-shield-alt"></i> დაზღვევა = -100 ₾
                </div>
            </div>
        </div>
    </div>

    <!-- Other Months Modal -->
    <div class="modal" id="otherMonthsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>სხვა თვეების ნახვა</h3>
                <button class="close-modal" onclick="closeOtherMonths()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Statistics -->
            <div class="stats-grid" id="globalStats">
                <!-- Global stats will be here -->
            </div>
            
            <div id="monthsContainer">
                <!-- Month cards will be generated here -->
            </div>
        </div>
    </div>

    <!-- Add Month Modal -->
    <div class="modal" id="addMonthModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ახალი თვის დამატება</h3>
                <button class="close-modal" onclick="closeAddMonthModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="shift-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>თვე</label>
                        <select id="newMonth" class="form-control">
                            <option value="0">იანვარი</option>
                            <option value="1">თებერვალი</option>
                            <option value="2">მარტი</option>
                            <option value="3">აპრილი</option>
                            <option value="4">მაისი</option>
                            <option value="5">ივნისი</option>
                            <option value="6">ივლისი</option>
                            <option value="7">აგვისტო</option>
                            <option value="8">სექტემბერი</option>
                            <option value="9">ოქტომბერი</option>
                            <option value="10">ნოემბერი</option>
                            <option value="11">დეკემბერი</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>წელი</label>
                        <input type="number" id="newYear" class="form-control" min="2020" max="2030" value="2024">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-success" onclick="addNewMonth()">
                        <i class="fas fa-plus"></i> დამატება
                    </button>
                    <button class="btn btn-danger" onclick="closeAddMonthModal()">
                        <i class="fas fa-times"></i> გაუქმება
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Shift Modal -->
    <div class="modal" id="addShiftModal">
        <div class="modal-content shift-modal-content">
            <div class="modal-header">
                <h3>მორიგეობის დამატება</h3>
                <button class="close-modal" onclick="closeAddShiftModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <h4>აირჩიეთ თარიღები, როცა მორიგობთ</h4>
                <div class="dates-grid" id="datesGrid">
                    <!-- Dates will be generated here -->
                </div>
            </div>
            
            <div class="shift-form" id="shiftForm" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label>თარიღი</label>
                        <input type="text" id="selectedDate" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>მორიგეობა (საათები)</label>
                        <input type="number" id="shiftDuty" class="form-control" min="0" step="0.5" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ობსერვაცია</label>
                        <input type="number" id="shiftObs" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>ჰემოტრანსფუზია</label>
                        <input type="number" id="shiftTrans" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>დღის სტაციონარი</label>
                        <input type="number" id="shiftStation" class="form-control" min="0" value="0">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveShiftData()">
                        <i class="fas fa-save"></i> შენახვა
                    </button>
                    <button class="btn btn-danger" onclick="closeAddShiftModal()">
                        <i class="fas fa-times"></i> გაუქმება
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Cell Popup -->
    <div class="edit-popup" id="editPopup">
        <h4 id="editDate">თარიღი</h4>
        <div>
            <label>მორიგეობა:</label>
            <input type="number" id="editDuty" min="0" step="0.5" value="0">
        </div>
        <div>
            <label>ობსერვაცია:</label>
            <input type="number" id="editObs" min="0" value="0">
        </div>
        <div>
            <label>ჰემოტრანსფუზია:</label>
            <input type="number" id="editTrans" min="0" value="0">
        </div>
        <div>
            <label>დღის სტაციონარი:</label>
            <input type="number" id="editStation" min="0" value="0">
        </div>
        <button class="btn btn-success" onclick="saveEdit()" style="margin-top: 10px; width: 100%;">შენახვა</button>
    </div>

    <!-- Popup Box -->
    <div class="popup-overlay" id="popupOverlay"></div>
    <div class="popup-box" id="popupBox">
        <h3 id="popupTitle">შეტყობინება</h3>
        <p id="popupMessage">ეს არის შეტყობინება</p>
        <button class="btn btn-primary" onclick="closePopup()">კარგი</button>
    </div>

    <script>
        // User credentials
        const USERNAME = "alex";
        const PASSWORD = "2911";

        // Current date
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let selectedDateForEdit = null;
        let selectedDateForShift = null;
        
        // Georgian month names
        const georgianMonths = [
            "იანვარი", "თებერვალი", "მარტი", "აპრილი", "მაისი", "ივნისი",
            "ივლისი", "აგვისტო", "სექტემბერი", "ოქტომბერი", "ნოემბერი", "დეკემბერი"
        ];

        // Data structure
        let monthlyData = {};

        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === USERNAME && password === PASSWORD) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainHeader').style.display = 'block';
                document.getElementById('mainApp').style.display = 'block';
                loadData();
                loadCurrentMonth();
            } else {
                showPopup("არასწორი მომხმარებელი ან პაროლი!", "error");
            }
        }

        // Logout function
        function logout() {
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Show popup message
        function showPopup(message, type = "info") {
            const popupBox = document.getElementById('popupBox');
            const popupOverlay = document.getElementById('popupOverlay');
            const popupTitle = document.getElementById('popupTitle');
            const popupMessage = document.getElementById('popupMessage');
            
            popupMessage.textContent = message;
            
            if (type === "error") {
                popupTitle.textContent = "შეცდომა!";
                popupTitle.style.color = "#e74c3c";
            } else if (type === "success") {
                popupTitle.textContent = "წარმატება!";
                popupTitle.style.color = "#27ae60";
            } else {
                popupTitle.textContent = "ინფორმაცია";
                popupTitle.style.color = "#3498db";
            }
            
            popupOverlay.style.display = 'block';
            popupBox.style.display = 'block';
        }

        // Close popup
        function closePopup() {
            document.getElementById('popupOverlay').style.display = 'none';
            document.getElementById('popupBox').style.display = 'none';
        }

        // Load current month data
        function loadCurrentMonth() {
            const monthKey = `${currentYear}-${currentMonth}`;
            const monthName = georgianMonths[currentMonth];
            document.getElementById('currentMonth').textContent = `${monthName} ${currentYear}`;
            
            // Create table
            createMonthTable(monthKey);
        }

        // Create table for a month
        function createMonthTable(monthKey) {
            const monthData = monthlyData[monthKey] || { shifts: {}, insurance: false, actualAmount: 0 };
            const [year, month] = monthKey.split('-').map(Number);
            const daysInMonth = new Date(year, parseInt(month) + 1, 0).getDate();
            
            // Create header
            const tableHeader = document.getElementById('tableHeader');
            tableHeader.innerHTML = '<th class="type-header">თარიღი</th>';
            
            // Add date columns
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${day}`;
                tableHeader.innerHTML += `<th class="date-header">${dateStr}</th>`;
            }
            
            // Add insurance column
            tableHeader.innerHTML += '<th class="type-header">დაზღვევა</th>';
            
            // Create rows
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            // Row 1: მორიგეობა (საათები)
            let row1 = '<tr><td class="type-header" onclick="editCell(0, -1)">მორიგეობა (საათები)</td>';
            for (let day = 1; day <= daysInMonth; day++) {
                const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
                const hasShift = shiftData.duty > 0 || shiftData.obs > 0 || shiftData.trans > 0 || shiftData.station > 0;
                const cellClass = hasShift ? 'shift-cell' : '';
                row1 += `<td class="${cellClass}" onclick="editCell(${day}, 0)">${shiftData.duty || 0}</td>`;
            }
            row1 += `<td><input type="checkbox" ${monthData.insurance ? 'checked' : ''} onchange="toggleInsurance(${month}, ${year}, this.checked)"></td></tr>`;
            
            // Row 2: ობსერვაცია
            let row2 = '<tr><td class="type-header" onclick="editCell(0, -2)">ობსერვაცია</td>';
            for (let day = 1; day <= daysInMonth; day++) {
                const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
                const hasShift = shiftData.duty > 0 || shiftData.obs > 0 || shiftData.trans > 0 || shiftData.station > 0;
                const cellClass = hasShift ? 'shift-cell' : '';
                row2 += `<td class="${cellClass}" onclick="editCell(${day}, 1)">${shiftData.obs || 0}</td>`;
            }
            row2 += `<td></td></tr>`;
            
            // Row 3: ჰემოტრანსფუზია
            let row3 = '<tr><td class="type-header" onclick="editCell(0, -3)">ჰემოტრანსფუზია</td>';
            for (let day = 1; day <= daysInMonth; day++) {
                const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
                const hasShift = shiftData.duty > 0 || shiftData.obs > 0 || shiftData.trans > 0 || shiftData.station > 0;
                const cellClass = hasShift ? 'shift-cell' : '';
                row3 += `<td class="${cellClass}" onclick="editCell(${day}, 2)">${shiftData.trans || 0}</td>`;
            }
            row3 += `<td></td></tr>`;
            
            // Row 4: დღის სტაციონარი
            let row4 = '<tr><td class="type-header" onclick="editCell(0, -4)">დღის სტაციონარი</td>';
            for (let day = 1; day <= daysInMonth; day++) {
                const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
                const hasShift = shiftData.duty > 0 || shiftData.obs > 0 || shiftData.trans > 0 || shiftData.station > 0;
                const cellClass = hasShift ? 'shift-cell' : '';
                row4 += `<td class="${cellClass}" onclick="editCell(${day}, 3)">${shiftData.station || 0}</td>`;
            }
            row4 += `<td></td></tr>`;
            
            tableBody.innerHTML = row1 + row2 + row3 + row4;
            
            // Calculate total
            calculateTotal(monthKey);
        }

        // Edit cell function
        function editCell(day, type) {
            if (day === 0) return;
            
            const monthKey = `${currentYear}-${currentMonth}`;
            const monthData = monthlyData[monthKey];
            if (!monthData) return;
            
            const shiftData = monthData.shifts[day] || { duty: 0, obs: 0, trans: 0, station: 0 };
            
            // Show edit popup
            const editPopup = document.getElementById('editPopup');
            editPopup.style.display = 'block';
            editPopup.style.left = (event.pageX + 10) + 'px';
            editPopup.style.top = (event.pageY + 10) + 'px';
            
            document.getElementById('editDate').textContent = `თარიღი: ${day}/${currentMonth + 1}`;
            document.getElementById('editDuty').value = shiftData.duty;
            document.getElementById('editObs').value = shiftData.obs;
            document.getElementById('editTrans').value = shiftData.trans;
            document.getElementById('editStation').value = shiftData.station;
            
            selectedDateForEdit = { day: day, monthKey: monthKey };
        }

        // Save edit
        function saveEdit() {
            if (!selectedDateForEdit) return;
            
            const day = selectedDateForEdit.day;
            const monthKey = selectedDateForEdit.monthKey;
            
            if (!monthlyData[monthKey]) {
                monthlyData[monthKey] = { shifts: {}, insurance: false, actualAmount: 0 };
            }
            
            monthlyData[monthKey].shifts[day] = {
                duty: parseFloat(document.getElementById('editDuty').value) || 0,
                obs: parseInt(document.getElementById('editObs').value) || 0,
                trans: parseInt(document.getElementById('editTrans').value) || 0,
                station: parseInt(document.getElementById('editStation').value) || 0
            };
            
            document.getElementById('editPopup').style.display = 'none';
            loadCurrentMonth();
            showPopup("მონაცემები შენახულია!", "success");
        }

        // Calculate total for a month
        function calculateTotal(monthKey) {
            const monthData = monthlyData[monthKey];
            if (!monthData) {
                document.getElementById('totalEarning').textContent = '0.00 ₾';
                return;
            }
            
            let total = 0;
            
            // Calculate from shifts
            Object.values(monthData.shifts).forEach(shift => {
                total += (shift.duty * 5.84) + (shift.obs * 7) + (shift.trans * 5) + (shift.station * 10);
            });
            
            // Subtract insurance if active
            if (monthData.insurance) {
                total -= 100;
            }
            
            document.getElementById('totalEarning').textContent = total.toFixed(2) + ' ₾';
            saveData();
        }

        // Toggle insurance for a month
        function toggleInsurance(month, year, isChecked) {
            const monthKey = `${year}-${month}`;
            if (!monthlyData[monthKey]) {
                monthlyData[monthKey] = { shifts: {}, insurance: false, actualAmount: 0 };
            }
            monthlyData[monthKey].insurance = isChecked;
            calculateTotal(monthKey);
        }

        // Show other months modal
        function showOtherMonths() {
            const monthsContainer = document.getElementById('monthsContainer');
            const globalStats = document.getElementById('globalStats');
            
            // Calculate global statistics
            calculateGlobalStats();
            
            monthsContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> იტვირთება...</div>';
            
            setTimeout(() => {
                monthsContainer.innerHTML = '';
                
                // Get all months with data
                const monthKeys = Object.keys(monthlyData).sort().reverse();
                
                if (monthKeys.length === 0) {
                    monthsContainer.innerHTML = '<div class="no-data">სხვა თვეების მონაცემები ჯერ არ არის შენახული</div>';
                } else {
                    monthKeys.forEach(monthKey => {
                        const [year, month] = monthKey.split('-').map(Number);
                        const monthName = georgianMonths[month];
                        const monthData = monthlyData[monthKey];
                        
                        // Calculate expected total for this month
                        let expectedTotal = 0;
                        Object.values(monthData.shifts).forEach(shift => {
                            expectedTotal += (shift.duty * 5.84) + (shift.obs * 7) + (shift.trans * 5) + (shift.station * 10);
                        });
                        if (monthData.insurance) expectedTotal -= 100;
                        
                        const monthCard = document.createElement('div');
                        monthCard.className = 'month-card';
                        monthCard.innerHTML = `
                            <div class="month-card-header">
                                ${monthName} ${year}
                            </div>
                            <div class="month-card-content">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; color: #555;">ჩარიცხული თანხა:</label>
                                    <input type="number" class="actual-amount-input" 
                                           value="${monthData.actualAmount || 0}" 
                                           onchange="updateActualAmount('${monthKey}', this.value)"
                                           placeholder="შეიყვანეთ ჩარიცხული თანხა">
                                </div>
                                <div style="color: #666; font-size: 14px;">
                                    <div>მოსალოდნელი: <strong>${expectedTotal.toFixed(2)} ₾</strong></div>
                                    <div>დაზღვევა: ${monthData.insurance ? 'კი' : 'არა'}</div>
                                </div>
                            </div>
                        `;
                        monthsContainer.appendChild(monthCard);
                    });
                }
                
                document.getElementById('otherMonthsModal').style.display = 'flex';
            }, 500);
        }

        // Calculate global statistics
        function calculateGlobalStats() {
            const globalStats = document.getElementById('globalStats');
            
            let totalEarned = 0;
            let actualAmounts = [];
            let expectedAmounts = [];
            let maxActual = 0;
            let minActual = 999999;
            let maxExpected = 0;
            let minExpected = 999999;
            
            Object.values(monthlyData).forEach(monthData => {
                // Calculate expected
                let expectedTotal = 0;
                Object.values(monthData.shifts).forEach(shift => {
                    expectedTotal += (shift.duty * 5.84) + (shift.obs * 7) + (shift.trans * 5) + (shift.station * 10);
                });
                if (monthData.insurance) expectedTotal -= 100;
                
                expectedAmounts.push(expectedTotal);
                if (expectedTotal > maxExpected) maxExpected = expectedTotal;
                if (expectedTotal < minExpected) minExpected = expectedTotal;
                
                // Add actual if exists
                if (monthData.actualAmount > 0) {
                    totalEarned += monthData.actualAmount;
                    actualAmounts.push(monthData.actualAmount);
                    if (monthData.actualAmount > maxActual) maxActual = monthData.actualAmount;
                    if (monthData.actualAmount < minActual) minActual = monthData.actualAmount;
                }
            });
            
            // If no actual amounts, use expected for min/max
            if (actualAmounts.length === 0) {
                maxActual = maxExpected;
                minActual = minExpected;
            }
            
            globalStats.innerHTML = `
                <div class="stat-card">
                    <h4>ჩარიცხული ხელფასი</h4>
                    <div class="value">${totalEarned.toFixed(2)} ₾</div>
                    <div style="font-size: 12px; color: #666;">ყველა თვის სულ</div>
                </div>
                <div class="stat-card">
                    <h4>მაქსიმალური ჩარიცხული</h4>
                    <div class="value">${maxActual.toFixed(2)} ₾</div>
                </div>
                <div class="stat-card">
                    <h4>მინიმალური ჩარიცხული</h4>
                    <div class="value">${minActual.toFixed(2)} ₾</div>
                </div>
                <div class="stat-card">
                    <h4>მაქსიმალური (მოლოდინი)</h4>
                    <div class="value">${maxExpected.toFixed(2)} ₾</div>
                </div>
                <div class="stat-card">
                    <h4>მინიმალური (მოლოდინი)</h4>
                    <div class="value">${minExpected.toFixed(2)} ₾</div>
                </div>
            `;
        }

        // Update actual amount for a month
        function updateActualAmount(monthKey, amount) {
            if (!monthlyData[monthKey]) return;
            monthlyData[monthKey].actualAmount = parseFloat(amount) || 0;
            saveData();
            calculateGlobalStats();
        }

        // Close other months modal
        function closeOtherMonths() {
            document.getElementById('otherMonthsModal').style.display = 'none';
        }

        // Show add month modal
        function showAddMonthModal() {
            document.getElementById('addMonthModal').style.display = 'flex';
        }

        // Close add month modal
        function closeAddMonthModal() {
            document.getElementById('addMonthModal').style.display = 'none';
        }

        // Add new month
        function addNewMonth() {
            const month = parseInt(document.getElementById('newMonth').value);
            const year = parseInt(document.getElementById('newYear').value);
            const monthKey = `${year}-${month}`;
            
            if (monthlyData[monthKey]) {
                showPopup("ეს თვე უკვე არსებობს!", "error");
                return;
            }
            
            monthlyData[monthKey] = { shifts: {}, insurance: false, actualAmount: 0 };
            currentMonth = month;
            currentYear = year;
            loadCurrentMonth();
            closeAddMonthModal();
            showPopup(`ახალი თვე დაემატა: ${georgianMonths[month]} ${year}`, "success");
        }

        // Show add shift modal
        function showAddShiftModal() {
            const monthKey = `${currentYear}-${currentMonth}`;
            if (!monthlyData[monthKey]) {
                showPopup("ჯერ შექმენით ამ თვის ცხრილი!", "error");
                return;
            }
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const datesGrid = document.getElementById('datesGrid');
            datesGrid.innerHTML = '';
            
            // Get existing shift days
            const existingShifts = monthlyData[monthKey].shifts || {};
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateCell = document.createElement('div');
                dateCell.className = 'date-cell-select';
                dateCell.textContent = day;
                dateCell.onclick = function() {
                    // Toggle selection
                    this.classList.toggle('selected');
                    selectedDateForShift = day;
                    
                    // Show shift form
                    document.getElementById('shiftForm').style.display = 'block';
                    document.getElementById('selectedDate').value = `${day}/${currentMonth + 1}`;
                    
                    // Load existing data if any
                    if (existingShifts[day]) {
                        document.getElementById('shiftDuty').value = existingShifts[day].duty || 0;
                        document.getElementById('shiftObs').value = existingShifts[day].obs || 0;
                        document.getElementById('shiftTrans').value = existingShifts[day].trans || 0;
                        document.getElementById('shiftStation').value = existingShifts[day].station || 0;
                    } else {
                        document.getElementById('shiftDuty').value = 0;
                        document.getElementById('shiftObs').value = 0;
                        document.getElementById('shiftTrans').value = 0;
                        document.getElementById('shiftStation').value = 0;
                    }
                };
                
                // Mark if already has shift
                if (existingShifts[day]) {
                    dateCell.classList.add('selected');
                    dateCell.style.background = '#27ae60';
                    dateCell.style.color = 'white';
                }
                
                datesGrid.appendChild(dateCell);
            }
            
            document.getElementById('shiftForm').style.display = 'none';
            document.getElementById('addShiftModal').style.display = 'flex';
        }

        // Close add shift modal
        function closeAddShiftModal() {
            document.getElementById('addShiftModal').style.display = 'none';
        }

        // Save shift data
        function saveShiftData() {
            if (!selectedDateForShift) {
                showPopup("აირჩიეთ თარიღი!", "error");
                return;
            }
            
            const day = selectedDateForShift;
            const monthKey = `${currentYear}-${currentMonth}`;
            
            monthlyData[monthKey].shifts[day] = {
                duty: parseFloat(document.getElementById('shiftDuty').value) || 0,
                obs: parseInt(document.getElementById('shiftObs').value) || 0,
                trans: parseInt(document.getElementById('shiftTrans').value) || 0,
                station: parseInt(document.getElementById('shiftStation').value) || 0
            };
            
            loadCurrentMonth();
            closeAddShiftModal();
            showPopup(`მორიგეობა დაემატა ${day}/${currentMonth + 1} თარიღზე`, "success");
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('mediClubData', JSON.stringify(monthlyData));
        }

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('mediClubData');
            if (savedData) {
                monthlyData = JSON.parse(savedData);
            }
        }

        // Initialize
        window.onload = function() {
            // Add event listener for Enter key in login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // Set default year to current year
            document.getElementById('newYear').value = currentDate.getFullYear();
            document.getElementById('newMonth').value = currentDate.getMonth();
            
            // Close edit popup when clicking outside
            document.addEventListener('click', function(e) {
                if (!document.getElementById('editPopup').contains(e.target)) {
                    document.getElementById('editPopup').style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>
