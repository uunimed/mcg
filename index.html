<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¡áƒ™áƒáƒœáƒ”áƒ áƒ˜</title>

<!-- ZXing barcode scanner -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f6f7f8;
  color: #111;
}

header {
  padding: 16px;
  text-align: center;
  font-size: 20px;
  font-weight: 600;
}

#scanner-container {
  width: 100%;
  max-width: 420px;
  margin: auto;
  padding: 12px;
}

#scanner {
  border-radius: 24px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

video {
  width: 100%;
}

.card {
  background: #fff;
  border-radius: 24px;
  padding: 16px;
  margin: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.card img {
  width: 100%;
  border-radius: 16px;
  margin-bottom: 12px;
}

.score {
  font-size: 18px;
  font-weight: bold;
}

.good { color: #1e8e3e; }
.bad { color: #d93025; }
.warn { color: #f29900; }

.alt {
  border-top: 1px solid #eee;
  margin-top: 12px;
  padding-top: 12px;
}

.loading {
  text-align: center;
  padding: 16px;
}
</style>
</head>

<body>

<header>ğŸ“¦ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¡áƒ™áƒáƒœáƒ”áƒ áƒ˜</header>

<div id="scanner-container">
  <div id="scanner">
    <video id="video"></video>
  </div>
</div>

<div id="output" class="card loading">
  áƒ“áƒáƒáƒ¡áƒ™áƒáƒœáƒ”áƒ áƒ”áƒ— áƒ¨áƒ¢áƒ áƒ˜áƒ®áƒ™áƒáƒ“áƒ˜ ğŸ“·
</div>

<audio id="beep">
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=">
</audio>

<script>
const codeReader = new ZXing.BrowserBarcodeReader();
const video = document.getElementById("video");
const output = document.getElementById("output");
const beep = document.getElementById("beep");

let scanning = true;

codeReader.decodeFromVideoDevice(null, video, (result, err) => {
  if (result && scanning) {
    scanning = false;
    navigator.vibrate(200);
    beep.play();
    loadProduct(result.text);
  }
});

async function loadProduct(barcode) {
  output.innerHTML = "áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...";

  try {
    const res = await fetch(
      `https://world.openfoodfacts.org/api/v0/product/${barcode}.json`
    );
    const data = await res.json();

    if (!data.product || !data.product.countries_tags?.includes("georgia")) {
      output.innerHTML = "âŒ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜ áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¨áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ";
      resetScanner();
      return;
    }

    const p = data.product;
    const score = p.nutriscore_grade?.toUpperCase() || "N/A";

    let scoreClass = "warn";
    if (score === "A" || score === "B") scoreClass = "good";
    if (score === "D" || score === "E") scoreClass = "bad";

    output.innerHTML = `
      <img src="${p.image_front_url || ""}">
      <h2>${p.product_name || "áƒ£áƒªáƒœáƒáƒ‘áƒ˜ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜"}</h2>

      <p class="score ${scoreClass}">
        Nutri-Score: ${score}
      </p>

      <p><b>áƒ™áƒáƒšáƒáƒ áƒ˜áƒ”áƒ‘áƒ˜:</b> ${p.nutriments?.energy_kcal || "?"} kcal</p>

      <p><b>áƒ¨áƒ”áƒ›áƒáƒ“áƒ’áƒ”áƒœáƒšáƒáƒ‘áƒ:</b><br>
      ${p.ingredients_text || "áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡"}</p>

      <p class="${scoreClass}">
        ${healthText(score)}
      </p>

      <div class="alt">
        <b>áƒ£áƒ™áƒ”áƒ—áƒ”áƒ¡áƒ˜ áƒáƒšáƒ¢áƒ”áƒ áƒœáƒáƒ¢áƒ˜áƒ•áƒ”áƒ‘áƒ˜:</b><br>
        ${alternativeText(score)}
      </div>
    `;

  } catch {
    output.innerHTML = "âš ï¸ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡";
  }

  setTimeout(resetScanner, 2500);
}

function healthText(score) {
  if (score === "A") return "âœ” áƒ«áƒáƒšáƒ˜áƒáƒœ áƒ¯áƒáƒœáƒ¡áƒáƒ¦áƒ˜ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜";
  if (score === "B") return "âœ” áƒ™áƒáƒ áƒ’áƒ˜ áƒáƒ áƒ©áƒ”áƒ•áƒáƒœáƒ˜";
  if (score === "C") return "âš  áƒ¡áƒáƒ¨áƒ£áƒáƒšáƒ áƒ®áƒáƒ áƒ˜áƒ¡áƒ®áƒ˜";
  if (score === "D") return "âŒ áƒáƒ áƒáƒ¯áƒáƒœáƒ¡áƒáƒ¦áƒ˜";
  if (score === "E") return "âŒ áƒ«áƒáƒšáƒ˜áƒáƒœ áƒáƒ áƒáƒ¯áƒáƒœáƒ¡áƒáƒ¦áƒ˜";
  return "âš  áƒ¨áƒ”áƒ¤áƒáƒ¡áƒ”áƒ‘áƒ áƒ›áƒ˜áƒ£áƒ¬áƒ•áƒ“áƒáƒ›áƒ”áƒšáƒ˜áƒ";
}

function alternativeText(score) {
  if (score === "D" || score === "E")
    return "áƒ áƒ”áƒ™áƒáƒ›áƒ”áƒœáƒ“áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ áƒ˜áƒ’áƒ˜áƒ•áƒ” áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ˜áƒ¡ A áƒáƒœ B áƒ¥áƒ£áƒšáƒ˜áƒ¡ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜";
  return "áƒáƒšáƒ¢áƒ”áƒ áƒœáƒáƒ¢áƒ˜áƒ•áƒ áƒ¡áƒáƒ­áƒ˜áƒ áƒ áƒáƒ  áƒáƒ áƒ˜áƒ¡";
}

function resetScanner() {
  scanning = true;
}
</script>

</body>
</html>
